<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒì—… ì§„ë‹¨ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .test-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .result {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .success { border-color: #4CAF50; background: #e8f5e8; }
        .error { border-color: #f44336; background: #ffebee; }
        .warning { border-color: #ff9800; background: #fff3e0; }
        
        input[type="email"] {
            width: 300px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px;
        }
        
        .step {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #4CAF50;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <h1>ğŸ” LittleScienceAI íŒì—… ì§„ë‹¨ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-container">
        <h2>1ë‹¨ê³„: ê¸°ë³¸ íŒì—… í…ŒìŠ¤íŠ¸</h2>
        <p>ë¸Œë¼ìš°ì € íŒì—… ì°¨ë‹¨ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button class="test-btn" onclick="testBasicPopup()">ê¸°ë³¸ íŒì—… í…ŒìŠ¤íŠ¸</button>
        <div id="basicResult" class="result"></div>
    </div>
    
    <div class="test-container">
        <h2>2ë‹¨ê³„: Google Apps Script URL ì ‘ê·¼ í…ŒìŠ¤íŠ¸</h2>
        <p>ì‹¤ì œ ìŠ¤í¬ë¦½íŠ¸ URLì— ì§ì ‘ ì ‘ê·¼í•´ì„œ ì‘ë‹µì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button class="test-btn" onclick="testScriptAccess()">ìŠ¤í¬ë¦½íŠ¸ ì ‘ê·¼ í…ŒìŠ¤íŠ¸</button>
        <div id="scriptResult" class="result"></div>
    </div>
    
    <div class="test-container">
        <h2>3ë‹¨ê³„: íŒŒë¼ë¯¸í„° í¬í•¨ íŒì—… í…ŒìŠ¤íŠ¸</h2>
        <p>ì‹¤ì œ ë¬´ë£Œì²´í—˜ê³¼ ë™ì¼í•œ íŒŒë¼ë¯¸í„°ë¡œ íŒì—…ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <input type="email" id="testEmail" placeholder="í…ŒìŠ¤íŠ¸ìš© ì´ë©”ì¼" value="test@example.com">
        <button class="test-btn" onclick="testParameterPopup()">íŒŒë¼ë¯¸í„° íŒì—… í…ŒìŠ¤íŠ¸</button>
        <div id="paramResult" class="result"></div>
    </div>
    
    <div class="test-container">
        <h2>4ë‹¨ê³„: postMessage í†µì‹  í…ŒìŠ¤íŠ¸</h2>
        <p>íŒì—…ê³¼ ë¶€ëª¨ ì°½ ê°„ì˜ ë©”ì‹œì§€ í†µì‹ ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <button class="test-btn" onclick="testPostMessage()">postMessage í…ŒìŠ¤íŠ¸</button>
        <div id="messageResult" class="result"></div>
    </div>
    
    <div class="test-container">
        <h2>5ë‹¨ê³„: ì „ì²´ í”„ë¡œì„¸ìŠ¤ í…ŒìŠ¤íŠ¸</h2>
        <p>ì‹¤ì œ ë¬´ë£Œì²´í—˜ ì‹ ì²­ê³¼ ë™ì¼í•œ ì „ì²´ ê³¼ì •ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <input type="email" id="realTestEmail" placeholder="ì‹¤ì œ í…ŒìŠ¤íŠ¸í•  ì´ë©”ì¼">
        <button class="test-btn" onclick="testFullProcess()">ì „ì²´ í”„ë¡œì„¸ìŠ¤ í…ŒìŠ¤íŠ¸</button>
        <div id="fullResult" class="result"></div>
    </div>

    <script>
        // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ Google Apps Script URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxk2od85OXtH8n1eKmsnKABkzwvx6u_S1IEoTI4-Ru69Iwr-PswaCQhFXALGGWyVdJVrg/exec';
        
        // postMessage ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.addEventListener('message', function(event) {
            console.log('ğŸ“¨ postMessage ìˆ˜ì‹ :', event.data);
            
            if (event.data && event.data.type === 'FREE_TRIAL_RESULT') {
                const result = document.getElementById('messageResult');
                result.className = 'result success';
                result.textContent = `âœ… postMessage ìˆ˜ì‹  ì„±ê³µ!\nìƒíƒœ: ${event.data.status}\në©”ì‹œì§€: ${event.data.message}`;
            }
        });
        
        // 1ë‹¨ê³„: ê¸°ë³¸ íŒì—… í…ŒìŠ¤íŠ¸
        function testBasicPopup() {
            const result = document.getElementById('basicResult');
            result.textContent = 'íŒì—… í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                const popup = window.open('about:blank', 'testPopup', 'width=400,height=300');
                
                if (popup) {
                    result.className = 'result success';
                    result.textContent = 'âœ… íŒì—… ì—´ê¸° ì„±ê³µ! ë¸Œë¼ìš°ì € ì°¨ë‹¨ ì—†ìŒ';
                    
                    popup.document.write(`
                        <html>
                            <body style="font-family: Arial; text-align: center; padding: 40px;">
                                <h2>âœ… íŒì—… í…ŒìŠ¤íŠ¸ ì„±ê³µ!</h2>
                                <p>ë¸Œë¼ìš°ì €ì—ì„œ íŒì—…ì´ ì •ìƒì ìœ¼ë¡œ ì—´ë ¸ìŠµë‹ˆë‹¤.</p>
                                <button onclick="window.close()">ì°½ ë‹«ê¸°</button>
                            </body>
                        </html>
                    `);
                } else {
                    result.className = 'result error';
                    result.textContent = 'âŒ íŒì—… ì°¨ë‹¨ë¨! ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ íŒì—… í—ˆìš© í•„ìš”';
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ íŒì—… í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
            }
        }
        
        // 2ë‹¨ê³„: Google Apps Script URL ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        async function testScriptAccess() {
            const result = document.getElementById('scriptResult');
            result.textContent = 'Google Apps Script ì ‘ê·¼ í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                // ë‹¨ìˆœ GET ìš”ì²­ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ ì‘ë‹µ í™•ì¸
                const response = await fetch(SCRIPT_URL);
                
                if (response.ok) {
                    const text = await response.text();
                    result.className = 'result success';
                    result.textContent = `âœ… ìŠ¤í¬ë¦½íŠ¸ ì ‘ê·¼ ì„±ê³µ!\nì‘ë‹µ ê¸¸ì´: ${text.length}ì\nì‘ë‹µ ì‹œì‘: ${text.substring(0, 200)}...`;
                } else {
                    result.className = 'result error';
                    result.textContent = `âŒ ìŠ¤í¬ë¦½íŠ¸ ì ‘ê·¼ ì‹¤íŒ¨\nHTTP ìƒíƒœ: ${response.status}\nì˜¤ë¥˜: ${response.statusText}`;
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ ìŠ¤í¬ë¦½íŠ¸ ì ‘ê·¼ ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        // 3ë‹¨ê³„: íŒŒë¼ë¯¸í„° í¬í•¨ íŒì—… í…ŒìŠ¤íŠ¸
        function testParameterPopup() {
            const result = document.getElementById('paramResult');
            const email = document.getElementById('testEmail').value;
            
            if (!email) {
                result.className = 'result warning';
                result.textContent = 'âš ï¸ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
                return;
            }
            
            result.textContent = 'íŒŒë¼ë¯¸í„° íŒì—… í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                const params = new URLSearchParams({
                    action: 'free_trial',
                    userEmail: email,
                    userIP: 'test_ip',
                    deviceFingerprint: 'test_fingerprint'
                });
                
                const popupUrl = `${SCRIPT_URL}?${params}`;
                console.log('íŒì—… URL:', popupUrl);
                
                const popup = window.open(popupUrl, 'paramTestPopup', 'width=500,height=400');
                
                if (popup) {
                    result.className = 'result success';
                    result.textContent = `âœ… íŒŒë¼ë¯¸í„° íŒì—… ì—´ê¸° ì„±ê³µ!\nURL: ${popupUrl}`;
                    
                    // íŒì—…ì´ ë‹«í˜”ëŠ”ì§€ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸
                    const checkClosed = setInterval(() => {
                        if (popup.closed) {
                            clearInterval(checkClosed);
                            result.textContent += '\n\níŒì—…ì´ ë‹«í˜”ìŠµë‹ˆë‹¤. ê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ postMessage ìˆ˜ì‹  ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.';
                        }
                    }, 1000);
                } else {
                    result.className = 'result error';
                    result.textContent = 'âŒ íŒŒë¼ë¯¸í„° íŒì—… ì°¨ë‹¨ë¨!';
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ íŒŒë¼ë¯¸í„° íŒì—… ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        // 4ë‹¨ê³„: postMessage í†µì‹  í…ŒìŠ¤íŠ¸
        function testPostMessage() {
            const result = document.getElementById('messageResult');
            result.textContent = 'postMessage í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì¤‘...';
            result.className = 'result warning';
            
            // í…ŒìŠ¤íŠ¸ìš© íŒì—… ìƒì„±
            const popup = window.open('about:blank', 'messageTestPopup', 'width=400,height=300');
            
            if (popup) {
                popup.document.write(`
                    <html>
                        <body style="font-family: Arial; text-align: center; padding: 20px;">
                            <h3>postMessage í…ŒìŠ¤íŠ¸</h3>
                            <button onclick="sendTestMessage()">í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡</button>
                            <script>
                                function sendTestMessage() {
                                    if (window.opener) {
                                        window.opener.postMessage({
                                            type: 'FREE_TRIAL_RESULT',
                                            status: 'SUCCESS',
                                            email: 'test@example.com',
                                            message: 'postMessage í…ŒìŠ¤íŠ¸ ì„±ê³µ!'
                                        }, '*');
                                        
                                        setTimeout(() => window.close(), 1000);
                                    }
                                }
                            </script>
                        </body>
                    </html>
                `);
                
                result.textContent = 'âœ… í…ŒìŠ¤íŠ¸ íŒì—…ì´ ì—´ë ¸ìŠµë‹ˆë‹¤. íŒì—…ì—ì„œ "í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';
            } else {
                result.className = 'result error';
                result.textContent = 'âŒ í…ŒìŠ¤íŠ¸ íŒì—…ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            }
        }
        
        // 5ë‹¨ê³„: ì „ì²´ í”„ë¡œì„¸ìŠ¤ í…ŒìŠ¤íŠ¸
        async function testFullProcess() {
            const result = document.getElementById('fullResult');
            const email = document.getElementById('realTestEmail').value;
            
            if (!email || !isValidEmail(email)) {
                result.className = 'result warning';
                result.textContent = 'âš ï¸ ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
                return;
            }
            
            result.textContent = 'ì „ì²´ í”„ë¡œì„¸ìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';
            result.className = 'result';
            
            try {
                // IP ê°€ì ¸ì˜¤ê¸° í…ŒìŠ¤íŠ¸
                result.textContent += '1. IP ì£¼ì†Œ í™•ì¸ ì¤‘...\n';
                let userIP = 'unknown';
                try {
                    const ipResponse = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipResponse.json();
                    userIP = ipData.ip || 'unknown';
                    result.textContent += `   âœ… IP í™•ì¸ ì„±ê³µ: ${userIP}\n`;
                } catch (ipError) {
                    result.textContent += `   âš ï¸ IP í™•ì¸ ì‹¤íŒ¨: ${ipError.message}\n`;
                }
                
                // ë””ë°”ì´ìŠ¤ í•‘ê±°í”„ë¦°íŠ¸ ìƒì„±
                result.textContent += '2. ë””ë°”ì´ìŠ¤ í•‘ê±°í”„ë¦°íŠ¸ ìƒì„±...\n';
                const fingerprint = generateDeviceFingerprint();
                result.textContent += `   âœ… í•‘ê±°í”„ë¦°íŠ¸: ${fingerprint}\n`;
                
                // íŒì—… URL ìƒì„±
                result.textContent += '3. íŒì—… URL ìƒì„±...\n';
                const params = new URLSearchParams({
                    action: 'free_trial',
                    userEmail: email,
                    userIP: userIP,
                    deviceFingerprint: fingerprint
                });
                
                const popupUrl = `${SCRIPT_URL}?${params}`;
                result.textContent += `   âœ… URL ìƒì„± ì™„ë£Œ\n`;
                
                // íŒì—… ì—´ê¸°
                result.textContent += '4. íŒì—… ì—´ê¸°...\n';
                const popup = window.open(popupUrl, 'fullTestPopup', 'width=500,height=400');
                
                if (popup) {
                    result.className = 'result success';
                    result.textContent += '   âœ… íŒì—… ì—´ê¸° ì„±ê³µ!\n\n';
                    result.textContent += 'ì´ì œ íŒì—…ì—ì„œ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ì„¸ìš”...\n';
                    result.textContent += 'postMessageë¡œ ê²°ê³¼ê°€ ì „ë‹¬ë˜ë©´ "4ë‹¨ê³„" ê²°ê³¼ì°½ì— í‘œì‹œë©ë‹ˆë‹¤.';
                } else {
                    result.className = 'result error';
                    result.textContent += '   âŒ íŒì—… ì°¨ë‹¨ë¨!\n';
                }
                
            } catch (error) {
                result.className = 'result error';
                result.textContent += `âŒ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function generateDeviceFingerprint() {
            try {
                const fingerprint = [
                    navigator.userAgent.slice(0, 50),
                    navigator.language,
                    screen.width + 'x' + screen.height,
                    new Date().getTimezoneOffset()
                ].join('|');
                
                return btoa(fingerprint).slice(0, 20);
            } catch (error) {
                return 'unknown';
            }
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        console.log('ğŸ” ì§„ë‹¨ ë„êµ¬ ë¡œë“œ ì™„ë£Œ');
        console.log('Google Apps Script URL:', SCRIPT_URL);
    </script>
</body>
</html>
