<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LittleScienceAI 무료체험 - 20분 무료로 체험해보세요!</title>
    <style>
        /* 원래 스타일 그대로 유지 */
        /* (중략 - 원본 스타일 전체 유지) */
    </style>
</head>
<body>
    <div class="container">
        <div class="free-badge">✨ 100% 무료</div>
        <div class="header">
            <h1>🧪 LittleScienceAI</h1>
            <div class="subtitle">20분 무료 체험</div>
            <p>과학논문 주제 탐색의 새로운 경험을 무료로 만나보세요.<br>결제 없이 이메일 하나로 바로 시작할 수 있습니다!</p>
        </div>
        <div class="benefits">
            <!-- 원래 혜택 섹션 유지 -->
        </div>
        <form class="form-section" onsubmit="handleFormSubmit(event)">
            <div class="input-group">
                <input type="email" id="userEmail" placeholder="📧 이메일 주소를 입력하세요" required>
                <button type="submit" class="send-btn" id="sendBtn">➤</button>
            </div>
            <div class="notice">
                ⚡ 체험용 액세스 코드가 즉시 발송됩니다
            </div>
        </form>
        <div class="result" id="resultMessage"></div>
        <div class="bottom-links">
            <!-- 하단 링크 유지 -->
        </div>
    </div>
    <script>
        async function getUserIP() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                return data.ip;
            } catch {
                return 'unknown';
            }
        }

        function generateDeviceFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('LittleScienceAI', 2, 2);
                return btoa([
                    navigator.userAgent,
                    navigator.language,
                    screen.width + 'x' + screen.height,
                    new Date().getTimezoneOffset(),
                    canvas.toDataURL()
                ].join('|')).slice(0, 20);
            } catch {
                return 'unknown';
            }
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            const email = document.getElementById('userEmail').value;
            const btn = document.getElementById('sendBtn');
            const resultDiv = document.getElementById('resultMessage');

            if (!isValidEmail(email)) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '올바른 이메일 주소를 입력해주세요.';
                resultDiv.style.display = 'block';
                return;
            }

            btn.disabled = true;
            btn.innerText = '⏳';
            resultDiv.style.display = 'none';

            const userIP = await getUserIP();
            const fingerprint = generateDeviceFingerprint();

            const formData = new FormData();
            formData.append('action', 'free_trial');
            formData.append('userEmail', email);
            formData.append('userIP', userIP);
            formData.append('deviceFingerprint', fingerprint);

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbzJn7ku_zQvtb-GP0Z_-QA1O1VWugYjc1_FIldnRbjwj1J6leheeRGqJgIt9nnokkXR0Q/exec', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `${email} 으로 코드가 발송되었습니다.`;
                } else {
                    throw new Error(result.message || '서버 오류');
                }
            } catch (err) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `전송 실패: ${err.message}`;
            } finally {
                resultDiv.style.display = 'block';
                btn.disabled = false;
                btn.innerText = '➤';
            }
        }

        function processFreeTrial(email) {
            console.warn("processFreeTrial는 더 이상 사용되지 않으며, handleFormSubmit 내부에서 fetch로 대체되었습니다.");
        }
    </script>
</body>
</html>
