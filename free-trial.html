<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LittleScienceAI 무료체험 - 20분 무료로 체험해보세요!</title>
  <!-- (생략) CSS 전체는 그대로 두었습니다 -->
  <style>
    /* ... 기존 CSS 전체 유지 ... */
  </style>
</head>
<body>
  <div class="container">
    <div class="free-badge">✨ 100% 무료</div>
    <div class="header">
      <h1>🧪 LittleScienceAI</h1>
      <div class="subtitle">20분 무료 체험</div>
      <p>과학논문 주제 탐색의 새로운 경험을 무료로 만나보세요.<br>결제 없이 이메일 하나로 바로 시작할 수 있습니다!</p>
    </div>

    <div class="benefits">
      <h3>⏰ 20분 동안 체험할 수 있는 것들</h3>
      <div class="benefit-grid">
        <div class="benefit-item"><div class="benefit-icon">🎯</div><div class="benefit-title">AI 주제 추천</div><div class="benefit-desc">관심 분야 입력 시 맞춤형 연구 주제 제안</div></div>
        <div class="benefit-item"><div class="benefit-icon">📚</div><div class="benefit-title">선행연구 분석</div><div class="benefit-desc">유사 연구 사례와 참고문헌 자동 탐색</div></div>
        <div class="benefit-item"><div class="benefit-icon">📄</div><div class="benefit-title">논문 구조 제안</div><div class="benefit-desc">서론, 방법론, 결론까지 체계적 가이드</div></div>
        <div class="benefit-item"><div class="benefit-icon">💡</div><div class="benefit-title">틈새 주제 발굴</div><div class="benefit-desc">창의적이고 독창적인 연구 방향 제시</div></div>
      </div>
    </div>

    <form class="form-section" onsubmit="handleFormSubmit(event)">
      <div class="input-group">
        <input type="email" id="userEmail" placeholder="📧 이메일 주소를 입력하세요" required>
        <button type="submit" class="send-btn" id="sendBtn">➤</button>
      </div>
      <div class="notice">⚡ 체험용 액세스 코드가 즉시 발송됩니다</div>
    </form>

    <div class="result" id="resultMessage"></div>

    <div class="bottom-links">
      <p>더 오래 사용하고 싶다면?</p>
      <a href="purchase.html" class="link-btn">💳 유료 이용권 구매</a>
      <a href="index.html" class="link-btn">🏠 메인 페이지로</a>
    </div>
  </div>

  <script>
    const TEST_MODE = false;

    function handleFormSubmit(event) {
      event.preventDefault();
      const email = document.getElementById('userEmail').value;
      const btn = document.getElementById('sendBtn');

      if (!email || !isValidEmail(email)) {
        showError('올바른 이메일 주소를 입력해주세요.');
        return;
      }

      if (TEST_MODE) {
        testMode(email);
      } else {
        btn.disabled = true;
        btn.className = 'send-btn loading';
        btn.innerHTML = '⏳';
        processFreeTrial(email).then(res => {
          btn.className = 'send-btn success';
          btn.innerHTML = '✅';
          showSuccess(`<h4>🎉 완료!</h4><p><strong>${res.email}</strong> 로 요청이 전송되었습니다.</p>`);
          setTimeout(() => resetButton(), 3000);
        }).catch(err => {
          btn.disabled = false;
          showError('전송 중 오류가 발생했습니다. 콘솔을 확인해주세요.');
          resetButton();
        });
      }
    }

    function processFreeTrial(email) {
      return new Promise(async (resolve, reject) => {
        try {
          const userIP = await getUserIP();
          const deviceFingerprint = generateDeviceFingerprint();
          const scriptUrl = 'https://script.google.com/macros/s/AKfycbzJn7ku_zQvtb-GP0Z_-QA1O1VWugYjc1_FIldnRbjwj1J6leheeRGqJgIt9nnokkXR0Q/exec';

          const form = document.createElement('form');
          form.method = 'POST';
          form.action = scriptUrl;
          form.target = '_blank';
          form.style.display = 'none';

          const fields = {
            action: 'free_trial',
            userEmail: email,
            userIP: userIP,
            deviceFingerprint: deviceFingerprint
          };

          Object.keys(fields).forEach(key => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = fields[key];
            form.appendChild(input);
          });

          document.body.appendChild(form);
          form.submit();

          setTimeout(() => {
            if (form.parentNode) document.body.removeChild(form);
          }, 1000);

          resolve({ success: true, email });
        } catch (error) {
          reject(error);
        }
      });
    }

    async function getUserIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
      } catch (e) {
        return 'unknown';
      }
    }

    function generateDeviceFingerprint() {
      try {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        ctx.textBaseline = 'top';
        ctx.font = '14px Arial';
        ctx.fillText('LittleScienceAI', 2, 2);

        const fingerprint = [
          navigator.userAgent,
          navigator.language,
          screen.width + 'x' + screen.height,
          new Date().getTimezoneOffset(),
          canvas.toDataURL()
        ].join('|');

        return btoa(fingerprint).slice(0, 20);
      } catch (e) {
        return 'unknown';
      }
    }

    function isValidEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function showSuccess(message) {
      const resultDiv = document.getElementById('resultMessage');
      resultDiv.className = 'result success';
      resultDiv.innerHTML = message;
      resultDiv.style.display = 'block';
      resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function showError(message) {
      const resultDiv = document.getElementById('resultMessage');
      resultDiv.className = 'result error';
      resultDiv.innerHTML = `<h4>❌ 오류</h4><p>${message}</p>`;
      resultDiv.style.display = 'block';
    }

    function resetButton() {
      const btn = document.getElementById('sendBtn');
      btn.disabled = false;
      btn.className = 'send-btn';
      btn.innerHTML = '➤';
    }

    function testMode(email) {
      const btn = document.getElementById('sendBtn');
      btn.disabled = true;
      btn.className = 'send-btn loading';
      btn.innerHTML = '⏳';
      setTimeout(() => {
        btn.className = 'send-btn success';
        btn.innerHTML = '✅';
        showSuccess(`<h4>🧪 테스트 모드</h4><p><strong>${email}</strong> 로 테스트 전송 완료.</p>`);
        setTimeout(() => resetButton(), 3000);
      }, 2000);
    }

    document.getElementById('userEmail').addEventListener('input', function (e) {
      const email = e.target.value;
      const btn = document.getElementById('sendBtn');
      if (email && isValidEmail(email)) {
        btn.style.opacity = '1';
        btn.style.transform = 'scale(1)';
      } else if (email) {
        btn.style.opacity = '0.7';
        btn.style.transform = 'scale(0.95)';
      } else {
        btn.style.opacity = '1';
        btn.style.transform = 'scale(1)';
      }
    });
  </script>
</body>
</html>
